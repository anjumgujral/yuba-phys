---
title: "07_preliminary-analyses"
author: "Anjum K. Gujral"
date: '2024-11-11'
output:
  html_document:
    df_print: paged
  pdf_document:
    output_dir: /Users/anjumgujral/Documents/repos/yuba-phys
---
#load packages
```{r, echo = FALSE, message = FALSE, warning = FALSE}
library('tinytex')
library('dplyr')
library('tidyverse')
library('ggplot2')
library(emmeans)
library(lme4)
library(lmerTest)
library(gridExtra)
library(ggcorrplot)
library(corrplot)
library("ggpubr")
```

# load data
```{r}
trait_data1<- read.csv("/Users/anjumgujral/Box Sync/yuba-phys_data/traits/yuba-phys-prepped-field-data-2024_2025.csv")

# subset dataframe by species 
ABCO <- trait_data1[trait_data1$species == 'ABCO',]
PILA <- trait_data1[trait_data1$species == 'PILA',]
PIPO <- trait_data1[trait_data1$species == 'PIPO',]
ABMA <- trait_data1[trait_data1$species == 'ABMA',]

```

#size distribution
```{r, echo = FALSE, message = FALSE, warning = FALSE}

ggplot(trait_data1, aes(x = diameter_complete, fill = size)) +
  geom_histogram(binwidth = 0.5, position = "dodge", alpha = 0.7, color = "black") +
  labs( 
       x = "Basal diameter (cm)", 
       y = "Frequency") +
  scale_fill_manual(values = c("lightblue", "lightgreen")) +
  theme_bw() +
  theme(
    panel.grid.major = element_blank(), 
    panel.grid.minor = element_blank())

```

# microsite distributions
```{r, echo = FALSE, message = FALSE, warning = FALSE}

ggplot(trait_data1, aes(x = diameter_complete, y = canopy_closure, color = species)) +
  geom_point(size = 3, alpha = 0.7) +
  labs(
       y = "Canopy closure", 
       x = "Basal diameter (cm)") +
  scale_color_manual(values = c("blue", "green", "red", "purple")) +
  theme_bw() +
  theme(
    panel.grid.major = element_blank(), 
    panel.grid.minor = element_blank())

```

Distribution of microsite environments across elevation
-- how similar are microsites at high and low elevation 
```{r, echo = FALSE, message = FALSE, warning = FALSE}
ggplot(trait_data1, aes(x = elevation, y = canopy_closure, fill = microsite)) +
  geom_boxplot() +
  labs(
    x = "Elevation",
    y = "Canopy Closure"
  ) +
    theme_bw() +
  theme(
    panel.grid.major = element_blank(), 
    panel.grid.minor = element_blank())+
  scale_fill_manual(values = c("skyblue", "lightgreen", "purple"))

# Create a new variable combining size_class and elevation
trait_data1$size_elevation <- interaction(trait_data1$size, trait_data1$elevation)


ggplot(trait_data1, aes(x = species, y = canopy_closure)) +
  geom_boxplot(alpha = 0.5, outlier.size = 3, outlier.colour = "black") +
  geom_point(aes(color = size_elevation), 
             position = position_jitter(width = 0.2, height = 0), 
             alpha = 0.7, size = 3) +
  labs(
    y = "Canopy closure", 
    x = "Species",
    color = "Size & Elevation"  
  ) +
  theme_bw() +
  theme(
    panel.grid.major = element_blank(), 
    panel.grid.minor = element_blank()
  )


ggplot(trait_data1, aes(x = microsite, y = canopy_closure)) +
  geom_boxplot(alpha = 0.5, outlier.size = 3, outlier.colour = "black") +
  geom_point(aes(color = size_elevation), 
             position = position_jitter(width = 0.2, height = 0), 
             alpha = 0.7, size = 3) +
  labs(
    y = "Canopy closure", 
    x = "Microsite level", 
    color = "Size & Elevation"  
  ) +
  facet_wrap(~ species, scales = "free_y") +
  theme_bw() +
  theme(
    panel.grid.major = element_blank(), 
    panel.grid.minor = element_blank()
  )

```

# stand basal area
Distribution of stand basal area across elevation
-- how similar is stand density between plots at high and low elevation
```{r, echo = FALSE, message = FALSE, warning = FALSE}
ggplot(trait_data1, aes(x = elevation, y = stand_basal_area, fill = elevation)) +
  geom_boxplot() +
  labs(
    x = "Elevation",
    y = "Stand Basal Area"
  ) +
    theme_bw() +
  theme(
    panel.grid.major = element_blank(), 
    panel.grid.minor = element_blank())+
  scale_fill_manual(values = c("skyblue", "lightgreen", "purple"))



ggplot(trait_data1, aes(x = species, y = stand_basal_area)) +
  geom_boxplot(alpha = 0.5, outlier.size = 3, outlier.colour = "black") +
  geom_point(aes(color = size_elevation), 
             position = position_jitter(width = 0.2, height = 0), 
             alpha = 0.7, size = 3) +
  labs(
    y = "Stand Basal Area ", 
    x = "Species",
    color = "Size & Elevation"
  ) +
  theme_bw() +
  theme(
    panel.grid.major = element_blank(), 
    panel.grid.minor = element_blank()
  )


ggplot(trait_data1, aes(x = microsite, y = stand_basal_area)) +
  geom_boxplot(alpha = 0.5, outlier.size = 3, outlier.colour = "black") +
  geom_point(aes(color = size_elevation), 
             position = position_jitter(width = 0.2, height = 0), 
             alpha = 0.7, size = 3) +
  labs(
    y = "Stand Basal Area", 
    x = "Microsite level", 
    color = "Size & Elevation" 
  ) +
  facet_wrap(~ species, scales = "free_y") +
  
  theme_bw() +
  theme(
    panel.grid.major = element_blank(), 
    panel.grid.minor = element_blank()
  )

```

# environmental variables
```{r}
# Create a correlation matrix for environmental variables
cor_matrix <- cor(trait_data1[, c("canopy_closure", "elevation_ft", "stand_basal_area")], use = "pairwise.complete.obs")
print(cor_matrix)

cor(trait_data1$elevation_ft, trait_data1$stand_basal_area, 
    use = "complete.obs", method = "pearson")

cor.test(trait_data1$stand_basal_area, trait_data1$elevation_ft, method="pearson")

# Create a custom set of axis labels (modify as per your needs)
custom_labels <- c("Canopy Closure", "Elevation (ft)", "Stand Basal Area")

colnames(cor_matrix) <- custom_labels
rownames(cor_matrix) <- custom_labels

# Visualize the correlation matrix with custom axis labels
corrplot(cor_matrix, 
         method = "color",          
         type = "lower",            
         order = "hclust",          
         addCoef.col = "black",    
         tl.col = "black",          
         tl.srt = 45,               
         tl.labels = custom_labels, 
         title = "Correlation Plot"
)

```

# table S1 models
```{r}

mod <- lmer(internode_length_1_2~ diameter_complete_scaled + predawn_scaled + HSM_midday_P50_mean_scaled + canopy_closure_scaled + elev_indiv_scaled + (1|plot), data = PILA)
summary(mod)


mod1 <- lm(HSM_predawn_combined ~ diameter, data = ABCO)
summary(mod1)

t.test(predawn_MPa_combined ~ year, data = trait_data1, paired = FALSE)
# There is a statistically significant difference between 2024 and 2025 predawn and midday water potential means. On average, predawn WP is higher (more negative) in 2024 and midday is 


trait_data1$HSM_predawn_scaled <- as.numeric(scale(trait_data1$HSM_predawn))
trait_data1$HSM_predawn_P50_mean_scaled <- as.numeric(scale(trait_data1$HSM_predawn_P50_mean))
trait_data1$HSM_midday_P50_mean_scaled <- as.numeric(scale(trait_data1$HSM_midday_P50_mean))

# run models with scaled response and predictor variables
mod5 <- lmer(HSM_predawn_P50_mean ~DBH_complete_scaled * percent_closure_scaled * elev_indiv_scaled + (1|plot), data = PIPO)
summary(mod5)

install.packages("emmeans")
library(emmeans)

mod4 <- lmer(HSM_midday_P50_mean ~ species * diameter_complete_scaled * elev_indiv_scaled * canopy_closure_scaled + (1|plot) + (1|year), data = trait_data1)
summary(mod4)

# table 3 pairwise comparisons using emmeans
emms1 <- emmeans(mod4, pairwise ~ species)
summary(emms1$emmeans)
summary(emms1$contrasts) #automatically adjusts to tukey, for multiple comparisons



model <- lmer(internode_length_1_2 ~  predawn_scaled + canopy_closure_scaled + P50_scaled +(1|plot), data = PILA)
summary(model)

trait_data1$residuals <- resid(model)

```

# table S2 models
```{r}


```

# table S3 models
```{r}


```

# table S4 models
```{r}


```

# table S5 models
```{r}


```
